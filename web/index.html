<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>Onionoo &mdash; a Tor network status protocol</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<link href="css/stylesheet-ltr.css" type="text/css" rel="stylesheet">
<link href="favicon.ico" type="image/x-icon" rel="shortcut icon">
</head>
<body>
<h3>Onionoo protocol overview</h3>
<p>The Onionoo service is designed as a RESTful web service.
Onionoo clients send HTTP GET requests to the Onionoo server which
responds with JSON-formatted replies.</p>
<p>Onionoo clients and their developers should follow a few rules:</p>
<ul>
<li><b>Compression:</b> Clients should include an <i>"Accept-Encoding:
gzip"</i> header in their requests and handle gzip-compressed responses.
Only requests starting at a certain size will be compressed by the
server.</li>
<li><b>Caching:</b> Clients should make use of the <i>"Last-Modified"</i>
header of responses and include that timestamp in a
<i>"If-Modified-Since"</i> header of subsequent requests.</li>
<li><b>Protocol changes:</b> There are plenty of reasons why we may have
to change the protocol described here.
Clients should be able to handle all valid JSON responses, ignoring
unknown fields and not breaking horribly in case of missing fields.
Protocol changes will be announced here by writing deprecated API parts in
<b><font color="red">red</font></b> and new parts in
<b><font color="blue">blue</font></b>.
Deprecated parts will be removed one month after their announcement.
Let us <a href="mailto:karsten.loesing@gmx.net">know</a> that you're
developing a client, and we're going to inform you of upcoming protocol
changes.
</li>
</ul>
<p>The Onionoo API is described by resource types and available methods
below.</p>
<br>
<h3>Summary documents</h3>
<p>Summary documents contain short summaries of relays with nicknames,
fingerprints, IP addresses, and running information as well as bridges
with hashed fingerprints and running information.
Summary documents contain the following fields:
<ul>
<li><b>"relays_published":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) when
the last contained relay network status consensus started being valid.
Indicates how recent the relay summaries in this document are.
Required field.</li>
<li><b>"relays":</b> Array of objects representing relay summaries.
Required field.
Each array object contains the following key-value pairs:
<ul>
<li><b>"n":</b> Relay nickname consisting of 1&ndash;19 alphanumerical
characters.
Optional field.
Omitted if the relay nickname is <i>"Unnamed"</i>.</li>
<li><b>"f":</b> Relay fingerprint consisting of 40 upper-case hexadecimal
characters.
Required field.</li>
<li><b>"a":</b> Array of IPv4 or IPv6 addresses where the relay accepts
onion-routing connections.
Required field.</li>
<li><b>"r":</b> Boolean field saying whether this relay was listed as
running in the last relay network status consensus.
Required field.</li>
</ul>
</li>
<li><b>"bridges_published":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) when
the last contained bridge network status was published.
Indicates how recent the bridge summaries in this document are.
Required field.</li>
<li><b>"bridges":</b> Array of objects representing bridge summaries.
Required field.
Each array object contains the following key-value pairs:
<ul>
<li><b>"h":</b> SHA-1 hash of the bridge fingerprint consisting of 40
upper-case hexadecimal characters.
Required field.</li>
<li><b>"r":</b> Boolean field saying whether this bridge was listed as
running in the last bridge network status.
Required field.</li>
</ul>
</ul>
<p>The following methods are available that all return a single summary
document.
The method and its parameters determines which relay and/or bridge
summaries are included in the response.
<font color="red">These methods have been deprecated on May 14, 2012 and
will be removed after July 14, 2012.
See the Methods section at the end of this page.</font>
</p>
<table border="0" cellpadding="4" cellspacing="0" summary="">
<colgroup>
<col width="350">
<col width="650">
</colgroup>
<tr>
<td><b>GET summary/all</b></td>
<td>Return summaries of all relays and bridges that are currently running
or that have been running in the past week.
<font color="red">New method:
<b>GET summary</b></font>
</td>
</tr>
<tr>
<td><b>GET summary/running</b></td>
<td>Return summaries of all relays and bridges that are currently
running.
<font color="red">New method:
<b>GET summary?running=true</b></font>
</td>
</tr>
<tr>
<td><b>GET summary/relays</b></td>
<td>Return summaries of all relays that are currently running or that have
been running in the past week, but don't include any bridges.
<font color="red">New method:
<b>GET summary?type=relay</b></font>
</td>
</tr>
<tr>
<td><b>GET summary/bridges</b></td>
<td>Return summaries of all bridges that are currently running or that
have been running in the past week, but don't include any relays.
<font color="red">New method:
<b>GET summary?type=bridge</b></font>
</td>
</tr>
<tr>
<td><b>GET summary/search/<i>:searchtext</i></b></td>
<td>Return summaries of all relays and bridges with <i>:searchtext</i>
matching the beginning of a nickname, (possibly $-prefixed) fingerprint,
IP address, or (possibly $-prefixed) hashed fingerprint.
Searches are case-insensitive.
Full fingerprints should always be hashed using SHA-1, regardless of
searching for a relay or a bridge, in order to not accidentally leak
non-hashed bridge fingerprints in the URL.
<font color="red">New method:
<b>GET summary?search=:searchtext</b></font>
</td>
</tr>
<tr>
<td><b>GET summary/lookup/<i>:fingerprint</i></b></td>
<td>Return the summary of the relay or bridge with <i>:fingerprint</i>
matching the fingerprint or hashed fingerprint.
Fingerprints should always be hashed using SHA-1, regardless of looking up
a relay or a bridge, in order to not accidentally leak non-hashed bridge
fingerprints in the URL.
<font color="red">New method:
<b>GET summary?lookup=:fingerprint</b></font>
</td>
</tr>
</table>
<br>
<h3>Detail documents</h3>
<p>Detail documents contain all known details of relays and bridges that
have been running in the past week.
Detail documents are based on the network statuses published by the Tor
directories and the server descriptors published by relays and bridges.
Detail documents contain the following fields:
<ul>
<li><b>"relays_published":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) when
the last contained relay network status consensus started being valid.
Indicates how recent the relay details in this document are.
Required field.</li>
<li><b>"relays":</b> Array of objects representing relay details.
Required field.
Each array object contains the following key-value pairs:
<ul>
<li><b>"nickname":</b> Relay nickname consisting of 1&ndash;19
alphanumerical characters.
Optional field.
Omitted if the relay nickname is <i>"Unnamed"</i>.</li>
<li><b>"fingerprint":</b> Relay fingerprint consisting of 40 upper-case
hexadecimal characters.
Required field.</li>
<li><b>"or_addresses":</b> Array of IPv4 or IPv6 addresses and TCP ports
or port lists where the relay accepts onion-routing connections.
Required field.</li>
<li><b>"exit_addresses":</b> Array of IPv4 or IPv6 addresses and TCP ports
or port lists that the relay used to exit to the Internet in the past 24
hours.
Only those addresses are listed that are different from onion-routing
addresses.
Optional field.
Omitted if array is empty.</li>
<li><b>"dir_address":</b> IPv4 address and TCP port where the relay
accepts directory connections.
Optional field.
Omitted if the relay does not accept directory connections.</li>
<li><b>"running":</b> Boolean field saying whether this relay was listed as
running in the last relay network status consensus.
Required field.</li>
<li><b>"flags":</b> Array of relay flags that the directory authorities
assigned to this relay.
Optional field.
Omitted if empty.</li>
<li><b>"country":</b> Two-letter lower-case country code as found in a
GeoIP database by resolving the relay's first onion-routing IP address.
Optional field.
Omitted if the relay IP address could not be found in the GeoIP
database.</li>
<li><b>"country_name":</b> Country name as found in a GeoIP database by
resolving the relay's first onion-routing IP address.
Optional field.
Omitted if the relay IP address could not be found in the GeoIP
database.</li>
<li><b>"region_name":</b> Region name as found in a GeoIP database by
resolving the relay's first onion-routing IP address.
Optional field.
Omitted if the relay IP address could not be found in the GeoIP
database.</li>
<li><b>"city_name":</b> City name as found in a
GeoIP database by resolving the relay's first onion-routing IP address.
Optional field.
Omitted if the relay IP address could not be found in the GeoIP
database.</li>
<li><b>"latitude":</b> Latitude as found in a GeoIP database by resolving
the relay's first onion-routing IP address.
Optional field.
Omitted if the relay IP address could not be found in the GeoIP
database.</li>
<li><b>"longitude":</b> Longitude as found in a GeoIP database by
resolving the relay's first onion-routing IP address.
Optional field.
Omitted if the relay IP address could not be found in the GeoIP
database.</li>
<li><b>"as_number":</b> AS number as found in an AS database by
resolving the relay's first onion-routing IP address.
Optional field.
Omitted if the relay IP address could not be found in the AS
database.</li>
<li><b>"as_name":</b> AS name as found in an AS database by resolving the
relay's first onion-routing IP address.
Optional field.
Omitted if the relay IP address could not be found in the AS
database.</li>
<li><b><font color="blue">"consensus_weight":</font></b> Bandwidth weight
assigned to this relay by the directory authorities.
The unit is arbitrary; currently it's kilobytes per second, but that might
change in the future.
Required field.
Added on May 14, 2012.</li>
<li><b>"last_restarted":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) when the
relay was last (re-)started.
Optional field.</li>
<li><b>"advertised_bandwidth":</b> Bandwidth in bytes per second that this
relay is willing and capable to provide.
Optional field.
Missing if router descriptor containing this information cannot be
found.</li>
<li><b>"exit_policy":</b> Array of exit-policy lines.
Optional field.
Missing if router descriptor containing this information cannot be
found.</li>
<li><b>"contact":</b> Contact address of the relay operator.
Omitted if empty or if descriptor containing this information cannot be
found.</li>
<li><b>"platform":</b> Platform string containing operating system and Tor
version details.
Optional field.
Omitted if empty or if descriptor containing this information cannot be
found.</li>
<li><b>"family":</b> Array of fingerprints or nicknames of relays in the
same family as this relay.
Optional field.
Omitted if empty or if descriptor containing this information cannot be
found.</li>
</ul>
</li>
<li><b>"bridges_published":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) when
the last contained bridge network status was published.
Indicates how recent the bridge details in this document are.
Required field.</li>
<li><b>"bridges":</b> Array of objects representing bridge summaries.
Required field.
Each array object contains the following key-value pairs:
<ul>
<li><b>"hashed_fingerprint":</b> SHA-1 hash of the bridge fingerprint
consisting of 40 upper-case hexadecimal characters.
Required field.</li>
<li><b>"or_addresses":</b> Array of sanitized IPv4 or IPv6 addresses and
TCP ports or port lists where the bridge accepts onion-routing
connections.
Sanitized IP addresses are always in <i>10/8</i> or
<i>[fd9f:2e19:3bcf/48]</i> IP networks and are only useful to learn which
IP version the bridge uses and to detect whether the bridge changed its
address.
Sanitized IP addresses always change on the 1st of every month at 00:00:00
UTC, regardless of the bridge actually changing its IP address.
TCP ports are not sanitized.
Required field.</li>
<li><b>"running":</b> Boolean field saying whether this bridge was listed
as running in the last bridge network status.
Required field.</li>
<li><b>"flags":</b> Array of relay flags that the bridge authority
assigned to this bridge.
Optional field.
Omitted if empty.</li>
<li><b>"last_restarted":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) when the
bridge was last (re-)started.
Optional field.
Missing if router descriptor containing this information cannot be
found.</li>
<li><b>"advertised_bandwidth":</b> Bandwidth in bytes per second that this
bridge is willing and capable to provide.
Optional field.
Missing if router descriptor containing this information cannot be
found.</li>
<li><b>"platform":</b> Platform string containing operating system and Tor
version details.
Optional field.
Omitted if not provided by the bridge or if descriptor containing this
information cannot be found.</li>
<li><b>"pool_assignment":</b> Information of the pool that BridgeDB
assigned this bridge to, including further assignment information if
available.
Optional field.</li>
</ul>
</li>
</ul>
<p>The following methods are available that all return a single details
document.
The method and its parameters determines which relay and/or bridge
details are included in the response.
<font color="red">These methods have been deprecated on May 14, 2012 and
will be removed after July 14, 2012.
See the Methods section at the end of this page.</font>
</p>
<table border="0" cellpadding="4" cellspacing="0" summary="">
<colgroup>
<col width="350">
<col width="650">
</colgroup>
<tr>
<td><b>GET details/all</b></td>
<td>Return details of all relays and bridges that are currently running
or that have been running in the past week.
<font color="red">New method:
<b>GET details</b></font>
</td>
</tr>
<tr>
<td><b>GET details/running</b></td>
<td>Return details of all relays and bridges that are currently
running.
<font color="red">New method:
<b>GET details?running=true</b></font>
</td>
</tr>
<tr>
<td><b>GET details/relays</b></td>
<td>Return details of all relays that are currently running or that have
been running in the past week, but don't include any bridges.
<font color="red">New method:
<b>GET details?type=relay</b></font>
</td>
</tr>
<tr>
<td><b>GET details/bridges</b></td>
<td>Return details of all bridges that are currently running or that have
been running in the past week, but don't include any relays.
<font color="red">New method:
<b>GET details?type=bridge</b></font>
</td>
</tr>
<tr>
<td><b>GET details/search/<i>:searchtext</i></b></td>
<td>Return details of all relays and bridges with <i>:searchtext</i>
matching the beginning of a nickname, (possibly $-prefixed) fingerprint,
IP address, or (possibly $-prefixed) hashed fingerprint.
Searches are case-insensitive.
Full fingerprints should always be hashed using SHA-1, regardless of
searching for a relay or a bridge, in order to not accidentally leak
non-hashed bridge fingerprints in the URL.
<font color="red">New method:
<b>GET details?search=:searchtext</b></font>
</td>
</tr>
<tr>
<td><b>GET details/lookup/<i>:fingerprint</i></b></td>
<td>Return the details of the relay or bridge with <i>:fingerprint</i>
matching the fingerprint or hashed fingerprint.
Fingerprints should always be hashed using SHA-1, regardless of looking up
a relay or a bridge, in order to not accidentally leak non-hashed bridge
fingerprints in the URL.
<font color="red">New method:
<b>GET details?lookup=:fingerprint</b></font>
</td>
</tr>
</table>
<br>
<h3>Bandwidth documents</h3>
<p>Bandwidth documents contain aggregate statistics of a relay's or
bridge's consumed bandwidth for different time intervals.
Bandwidth documents are available for all relays and bridges that have
been running in the past week.
Bandwidth documents contain the following fields:
<ul>
<li><b>"relays_published":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) when
the last contained relay network status consensus started being valid.
Indicates how recent the relay bandwidth documents in this document are.
Required field.</li>
<li><b>"relays":</b> Array of objects representing relay bandwidth
documents.
Required field.
Each array object contains the following key-value pairs:
<ul>
<li><b>"fingerprint":</b> Relay fingerprint consisting of 40 upper-case
hexadecimal characters.
Required field.</li>
<li><b>"write_history":</b> Object containing bandwidth history objects
for different time periods.
Required field.
Keys are string representation of the time period covered by the bandwidth
history object.
Keys are fixed strings <i>"3_days"</i>, <i>"1_week"</i>, <i>"1_month"</i>,
<i>"3_months"</i>, <i>"1_year"</i>, and <i>"5_years"</i>.
Keys refer to the last known bandwidth history of a relay, not to the time
when the bandwidth document was published.
A bandwidth history object is only contained if the time period it covers
is not already contained in another bandwidth history object with shorter
time period and higher data resolution.
Each bandwidth history object contains the following key-value pairs:
<ul>
<li><b>"first":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) of the first data
data point in the bandwidth history.
Required field.</li>
<li><b>"last":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) of the last data
data point in the bandwidth history.
Required field.</li>
<li><b>"interval":</b> Time interval between two data points in seconds.
Required field.</li>
<li><b>"factor":</b> Factor by which subsequent bandwidth values need to
be multiplied to get a unit of bytes per second.
The idea is that contained bandwidth values are normalized to a range from
0 to 999 to reduce document size while still providing sufficient detail
for both slow and fast relays.
Required field.</li>
<li><b>"count":</b> Number of provided data points, included mostly for
debugging purposes.
Can also be derived from the number of elements in the subsequent array.
Optional field.</li>
<li><b>"values":</b> Array of normalized bandwidth values in bytes per
second.
May contain null values if the relay did not provide any bandwidth data or
only data for less than 20% of a given time period.
Only includes non-null values for series of at least two subsequent data
points to enable drawing of line graphs.
Required field.</li>
</ul>
</li>
<li><b>"read_history":</b> Object containing bandwidth history objects
for different time periods.
Required field.
The specification of bandwidth history objects is similar to those in the
<i>write_history</i> field.</li>
</ul>
</li>
<li><b>"bridges_published":</b> UTC timestamp (YYYY-MM-DD hh:mm:ss) when
the last contained bridge network status was published.
Indicates how recent the bridge bandwidth documents in this document are.
Required field.</li>
<li><b>"bridges":</b> Array of objects representing bridge bandwidth
documents.
Required field.
Each array object contains the following key-value pairs:
<ul>
<li><b>"fingerprint":</b> SHA-1 hash of the bridge fingerprint consisting
of 40 upper-case hexadecimal characters.
Required field.</li>
<li><b>"write_history":</b> Object containing bandwidth history objects
for different time periods.
Required field.
The specification of bandwidth history objects is similar to those in the
<i>write_history</i> field of <i>relays</i>.</li>
<li><b>"read_history":</b> Object containing bandwidth history objects
for different time periods.
Required field.
The specification of bandwidth history objects is similar to those in the
<i>write_history</i> field of <i>relays</i>.</li>
</ul>
</li>
</ul>
<p>The following methods are available that all return a single document.
The method and its parameters determines which relay and/or bridge
bandwidth documents are included in the response.
<font color="red">These methods have been deprecated on May 14, 2012 and
will be removed after July 14, 2012.
See the Methods section at the end of this page.</font>
</p>
<table border="0" cellpadding="4" cellspacing="0" summary="">
<colgroup>
<col width="350">
<col width="650">
</colgroup>
<tr>
<td><b>GET bandwidth/all</b></td>
<td>Return bandwidth documents of all relays and bridges that are
currently running or that have been running in the past week.
<font color="red">New method:
<b>GET bandwidth</b></font>
</td>
</tr>
<tr>
<td><b>GET bandwidth/running</b></td>
<td>Return bandwidth documents of all relays and bridges that are
currently running.
<font color="red">New method:
<b>GET bandwidth?running=true</b></font>
</td>
</tr>
<tr>
<td><b>GET bandwidth/relays</b></td>
<td>Return bandwidth documents of all relays that are currently running or
that have been running in the past week, but don't include any bridges.
<font color="red">New method:
<b>GET bandwidth?type=relay</b></font>
</td>
</tr>
<tr>
<td><b>GET bandwidth/bridges</b></td>
<td>Return bandwidth documents of all bridges that are currently running
or that have been running in the past week, but don't include any
relays.
<font color="red">New method:
<b>GET bandwidth?type=bridge</b></font>
</td>
</tr>
<tr>
<td><b>GET details/search/<i>:searchtext</i></b></td>
<td>Return bandwidth documents of all relays and bridges with
<i>:searchtext</i> matching the beginning of a nickname, (possibly
$-prefixed) fingerprint, IP address, or (possibly $-prefixed) hashed
fingerprint.
Searches are case-insensitive.
Full fingerprints should always be hashed using SHA-1, regardless of
searching for a relay or a bridge, in order to not accidentally leak
non-hashed bridge fingerprints in the URL.
<font color="red">New method:
<b>GET bandwidth?search=:searchtext</b></font>
</td>
</tr>
<tr>
<td><b>GET bandwidth/lookup/<i>:fingerprint</i></b></td>
<td>Return the bandwidth document of the relay or bridge with
<i>:fingerprint</i> matching the fingerprint or hashed fingerprint.
Fingerprints should always be hashed using SHA-1, regardless of looking up
a relay or a bridge, in order to not accidentally leak non-hashed bridge
fingerprints in the URL.
<font color="red">New method:
<b>GET bandwidth?lookup=:fingerprint</b></font>
</td>
</tr>
</table>
<br>
<h3>Methods</h3>
<p>The following methods each return a single document containing zero or
more relay and/or bridge documents.</p>
<table border="0" cellpadding="4" cellspacing="0" summary="">
<colgroup>
<col width="150">
<col width="850">
</colgroup>
<tr>
<td><b>GET summary</b></td>
<td>Return summaries of all relays and bridges that are currently running
or that have been running in the past week.
<font color="blue">Method added on May 14, 2012.</font>
</td>
</tr>
<tr>
<td><b>GET details</b></td>
<td>Return details of all relays and bridges that are currently running
or that have been running in the past week.
<font color="blue">Method added on May 14, 2012.</font>
</td>
</tr>
<tr>
<td><b>GET bandwidth</b></td>
<td>Return bandwidth documents of all relays and bridges that are
currently running or that have been running in the past week.
<font color="blue">Method added on May 14, 2012.</font>
</td>
</tr>
</table>
<p>Each of the methods above can be parameterized to select only a subset
of relay and/or bridge documents to be included in the response.</p>
<table border="0" cellpadding="4" cellspacing="0" summary="">
<colgroup>
<col width="150">
<col width="850">
</colgroup>
<tr><td><b>type</b></td><td>Return only relay (parameter value
<b>relay</b>) or only bridge documents (parameter value
<b>bridge</b>).
<font color="blue">Parameter added on May 14, 2012.</font>
</td></tr>
<tr><td><b>running</b></td><td>Return only running (parameter value
<b>true</b>) or only non-running relays and/or bridges (paramter value
<b>false</b>).
<font color="blue">Parameter added on May 14, 2012.</font>
</td></tr>
<tr><td><b>search</b></td><td>Return only relays with the parameter value
matching the beginning of a nickname, (possibly $-prefixed) fingerprint,
or IP address, and bridges with the (possibly $-prefixed) hashed
fingerprint.
Searches are case-insensitive.
Full fingerprints should always be hashed using SHA-1, regardless of
searching for a relay or a bridge, in order to not accidentally leak
non-hashed bridge fingerprints in the URL.
<font color="blue">Parameter added on May 14, 2012.</font>
</td></tr>
<tr><td><b>lookup</b></td><td>Return only the relay with the parameter
value matching the fingerprint or the bridge with the parameter value
matching the hashed fingerprint.
Fingerprints should always be hashed using SHA-1, regardless of looking up
a relay or a bridge, in order to not accidentally leak non-hashed bridge
fingerprints in the URL.
<font color="blue">Parameter added on May 14, 2012.</font>
</td></tr>
</table>
<p>Relay and/or bridge documents in the response can be ordered and
limited by providing further parameters.</p>
<table border="0" cellpadding="4" cellspacing="0" summary="">
<colgroup>
<col width="150">
<col width="850">
</colgroup>
<tr><td><b>order</b></td><td>Re-order results by a comma-separated list
of fields in ascending or descening order.
Results are first ordered by the second list element, then by the second,
and so on.
Possible fields for ordering are: <b>consensus_weight</b>.
Ascending order is the default; descending order is selected by prepending
fields with a minus sign (<b>-</b>).
Relays which don't have any value for a field to be ordered by are always
appended to the end, regardless or sorting order.
If no <b>order</b> parameter is given, ordering of results is
undefined.
<font color="blue">Parameter added on May 14, 2012.</font>
</td></tr>
<tr><td><b>offset</b></td><td>Skip the given number of relays and/or
bridges.
<font color="blue">Parameter added on May 14, 2012.</font>
</td></tr>
<tr><td><b>limit</b></td><td>Limit result to the given number of
relays and/or bridges.
When used together with <b>offset</b>, the offsetting step precedes the
limiting step.
<font color="blue">Parameter added on May 14, 2012.</font>
</td></tr>
</table>
</body>
</html>

